!function(e,t){function n(e){if(this.template){if(this.template.html){e=e||this.data||{};var n=!0;if(void 0==this.template.mstid){var r=document.createElement("span");r.innerHTML=this.template.html,1==r.children.length&&(r=r.children[0]),this.template.mstid=r.dataset.mstid=Math.floor(Math.random()*Date.now()),this.template.html=r.outerHTML,n=!1}var o=t.render(this.template.html,e);if(n){var a=document.querySelector('[data-mstid="'+this.template.mstid+'"');a&&(a.outerHTML=o)}else this.template.container&&(this.template.append?this.template.container.appendChild(o):this.template.container.innerHTML=o);return o}throw new Error("Template HTML unavailable")}}function r(t){if(t.path){var n=new XMLHttpRequest;if(!n)throw new Error("XMLHttpRequest Unsupported");var r=t.path;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE){if(200!=n.status)throw new Error("Failed to load template '"+r+"'. Status Code "+n.status);t.html=n.responseText,o(t.html)}};var r=e.ComponentLoader.templatePath?e.ComponentLoader.templatePath+r:r;n.open("GET",r),n.send()}else{if(!t.html)throw new Error("Template path or html not provided");o(t.html)}}function o(e){t.parse(e)}for(var a={css:[],js:[],fonts:[]},i=document.getElementsByTagName("link"),s=0;s<i.length;s++)i[s].href&&a.css.push(i[s].href);for(var p=document.getElementsByTagName("script"),s=0;s<p.length;s++)p[s].src&&a.js.push(p[s].src);var u=function(){},l=function(e){e=e||{},this.init=e.init&&"function"==typeof e.init?e.init:null,this.update=e.update&&"function"==typeof e.update?e.update:null,this.template=e.template||null,this.dependencies=e.dependencies||null,this.template=e.template||null,this.render=e.render||n,this.data=e.data||{},this.template&&r(this.template)};u.prototype.load=function(e,t){if(e){t=t||{};var n=typeof e,r=null;if("function"==n)r={init:e};else{if("object"!=n)throw new Error("Unsupported component type '"+n+"'");r=Object.assign({},e),r.template&&(t.container?r.template=Object.assign({},r.template,{container:t.container,html:e.template.html.slice(0)}):r.template=Object.assign({},r.template,{html:e.template.html.slice(0)}))}if(t.route&&(r.route=Object.assign({},t.route)),t.match&&(r.route.match=t.match.path,r.route.args=t.match.args),e.dependencies){if(e.dependencies.css){for(var o=e.dependencies.css,i=0;i<o.length;i++)if(-1===a.css.indexOf(o[i])){var s=document.createElement("link");s.href=o[i],document.head.appendChild(s),a.css.push(o[i])}e.dependencies.css=void 0}if(e.dependencies.js){for(var p=e.dependencies.js,i=0;i<p.length;i++)if(-1===a.js.indexOf(p[i])){var u=document.createElement("script");u.type="text/javascript",u.src=p[i],document.head.appendChild(u),a.js.push(p[i])}e.dependencies.js=void 0}}return r.render&&r.render(),r.init&&r.init(),r}throw new Error("Component not provided")},e.Component=l,e.ComponentLoader=new u}(window,Mustache),function(e,t,n){function r(){for(var t=e.location.hash.substring(1),r=!1,a=0;a<i.routes.length&&!(r=o(i.routes[a],t));a++);if(r){var p=i.routes[a].name;n.load(i.components[a],{route:s.routes[p],match:r})}else{if(!i.names.includes("default"))throw new Error("No matching route defined");s.routeTo("default")}}function o(e,t){var n=t.match(new RegExp("^"+e.regex+"$"));if(n){var r=n.slice(1),o={};if(e.params.length)for(var a=0;a<e.params.length;a++)o[e.params[a].name]=r[a];return{path:t,args:o}}return!1}function a(e){var t=e,n=e,r=e.match(/{[^\/]*}/g),o=[];if(r)for(var a=0;a<r.length;a++){var i=r[a].replace(/{|}/g,"");i=i.split(":"),1==i.length&&(i[1]="\\w+"),n=n.replace(r[a],"{"+i[0]+"}"),e=e.replace(r[a],"("+i[1]+")"),o.push({name:i[0],expr:i[1]})}return{regex:e,original:t,link:n,params:o}}var i={regex:[],names:[],components:[],routes:[]},s=null;Router=function(){s=this,this.routes={}},Router.prototype.register=function(){this.register=void 0,e.onhashchange=r,r()};var p=document.getElementById("content");if(void 0==p)throw new Error("Page content element undefined");Router.prototype.add=function(e){if(!e.path)throw new Error("Route path undefined");var n=a(e.path);if(n.name=e.name||Date.now(),!e.component)throw new Error("Route component undefined");return e.component.template&&(e.component.template.replace=!0,e.component.template.container=p),i.components.push(new t(e.component)),i.names.push(n.name),i.regex.push(n.regex),i.routes.push(n),this.routes[n.name]=n,this},Router.prototype.routeTo=function(t,n){e.location.hash=this.linkTo(t,n)},Router.prototype.linkTo=function(e,t){if(t=t||{},this.routes[e]){var n=this.routes[e],r=n.link;if(n.params.length!=Object.keys(t).length)throw new Error("Insufficient route parameters");for(var o=0;o<n.params.length;o++){if(!t[n.params[o].name])throw new Error("Route parameter '"+n.params[o].name+"' not provided");r=r.replace("{"+n.params[o].name+"}",t[n.params[o].name])}return r}throw new Error("Route does not exist")},e.Router=new Router}(window,Component,ComponentLoader),function(e){function t(e){var n=e;if(n&&"object"==typeof n){n=Array.isArray(n)?[]:{};for(key in e)n[key]=t(e[key])}return n}var n={},r={},o=function(){};o.prototype.subscribe=function(e,t){if(t.update&&"function"==typeof t.update)return r[e]=r[e]||[],r[e].push(t),function(){r[e].filter(function(e){return e!=t})};throw new Error("Component does not contain update() callback")},o.prototype.set=function(e,o){if(n[e]=t(o),r[e])for(var a=0;a<r[e].length;a++)r[e][a].update&&r[e][a].update.call(r[e][a]),r[e][a].update&&r[e][a].render&&r[e][a].render.call(r[e][a])},o.prototype.get=function(e){return t(n[e]||null)},e.State=new o}(window);
